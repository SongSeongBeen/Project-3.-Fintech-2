name: Weekly Security Scan

on:
  schedule:
    # ë§¤ì£¼ ì¼ìš”ì¼ ì €ë… 6ì‹œ (UTC)
    - cron: '0 18 * * 0'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

env:
  JAVA_VERSION: '21'

jobs:
  # ì£¼ê°„ ë³´ì•ˆ ìŠ¤ìº”
  weekly-security-scan:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK ${{ env.JAVA_VERSION }}
      uses: actions/setup-java@v4
      with:
        java-version: ${{ env.JAVA_VERSION }}
        distribution: 'temurin'
        cache: 'gradle'
        
    - name: Cache Gradle packages
      uses: actions/cache@v3
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-gradle-
          
    - name: Run OWASP dependency check
      run: ./gradlew dependencyCheckAnalyze
      
    - name: Upload security results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: weekly-security-results
        path: build/reports/dependency-check/
        retention-days: 90  # ì£¼ê°„ ê²°ê³¼ëŠ” 90ì¼ ë³´ê´€

  # ì£¼ê°„ ë³´ì•ˆ ìŠ¤ìº” ìš”ì•½
  security-summary:
    runs-on: ubuntu-latest
    needs: [weekly-security-scan]
    
    steps:
    - name: Weekly Security Summary
      run: |
        echo "ğŸ”’ Weekly Security Scan Completed!"
        echo "ğŸ“… Scan Date: $(date)"
        echo "ğŸ“Š Security Results: Available in artifacts"
        echo "ğŸ“‹ Check: build/reports/dependency-check/"
        echo "ğŸ’¡ This scan runs every Sunday at 6 PM UTC"
        echo "ğŸ”§ Manual trigger available via workflow_dispatch" 